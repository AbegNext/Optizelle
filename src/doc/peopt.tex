\documentclass{report}

% All of the packages required
\usepackage{amssymb}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{url}
\usepackage{subfig}
\usepackage{longtable}

% Change the figure numbering to be chap.sec.num
\renewcommand{\thefigure}{\arabic{chapter}.\arabic{section}.\arabic{figure}}

% Simple macros to help printing
\newcommand{\re}{\mathbb{R}}

% Create some new environments for displaying code and output
\lstdefinelanguage{peoptOutput}{
    morekeywords={Iter,f,x,merit,grad,dx,KryWhy,KryErr,KryIter,ared,pred,
        ared/pred,mu,mu_est},
    sensitive=false
}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}
\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {e-}{{{\color{numb}e-}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\lstnewenvironment{lstCpp}
    { \lstset {
        language=C++,
        backgroundcolor=\color{black!5},
        showstringspaces=false,
        basicstyle=\footnotesize
    } }
    {}

\lstnewenvironment{lstPeopt}
    { \lstset {
        language=peoptOutput,
        backgroundcolor=\color{black!5},
        basicstyle=\scriptsize
    }}
    {}

\lstnewenvironment{lstPeoptJSON}
    { \lstset {
        language=json,
        backgroundcolor=\color{black!5},
        basicstyle=\footnotesize
    }}
    {}

\title{Pretty Efficient Optimization (PEOpt)}
\author{Joseph Young}
\begin{document}
\maketitle
\tableofcontents

\chapter{Introduction}

        The PEOpt (\underline{P}retty \underline{E}fficient \underline{Opt}imization) library contains a collection of routines used to solve a variety of nonlinear optimization problems.  It focuses on open ended abstractions that make it easy to interface to existing applications.

\section{Unconstrained Optimization}\setcounter{figure}{1}

        The PEopt unconstrained optimization routines solve problems of the form
$$
        \min_{x\in X} f(x)
$$
where $f:X\rightarrow \re$ denotes a differentiable function.  For example, we formulate the minimization of the Rosenbrock function as
$$
        \min_{x\in\re^2} (1-x_1)^2+100(x_2-x_1^2)^2.
$$
In PEOpt, we minimize the Rosenbrock function with the code in Figure \ref{fig:Rosen} and the input specification in Figure \ref{fig:RosenJSON}, which generates the output in Figure \ref{fig:RosenOut}.  We explain the functions used to generate this example in Chapter \ref{ch:Basic}, the input specification in Chapter \ref{ch:Input}, and the output in Chapter \ref{ch:Output}.

\input{rosen_code.tex}
\input{rosen_input.tex}
\input{rosen_output.tex}

\section{Inequality Constrained Optimization}\setcounter{figure}{2}

        The PEopt inequality constrained optimization routines solve problems in the form
$$
        \min_{x\in X} \{ f(x) : h(x)\succeq 0\}
$$
where $f:X\rightarrow \re$ denotes a differentiable function, $h:X\rightarrow Z$ denotes an affine function, and $\succeq$ denotes a partial order that corresponds to a symmetric cone.  A symmetric cone includes inequalities such as pointwise inequalities, second-order cones, and semidefinite cones.  For example, these problems include linearly constrained quadratic programs such as
$$
        \min_{x\in\re^2}\{(x_1+1)^2+(x_2+1)^2 : x_1 + 2x_2 \geq 1, 2x_1 + x_2\geq 1\}
$$
In PEOpt, we minimize the above inequality constrained problem with the code in Figure \ref{fig:simpleIneq} and the input specification in Figure \ref{fig:simpleIneqJSON}, which generates the output in Figure \ref{fig:simpleIneqOut}.  As with the unconstrained example, we explain the functions used to generate this example in Chapter \ref{ch:Basic}, the input specification in Chapter \ref{ch:Input}, and the output in Chapter \ref{ch:Output}.

\input{simple_ineq_code.tex}
\input{simple_ineq_input.tex}
\input{simple_ineq_output.tex}

\section{Equality Constrained Optimization}\setcounter{figure}{2}

        The PEOpt equality constrained optimization routines solve problems in the form
$$
        \min_{x\in X} \{ f(x) : g(x)=0 \}
$$
where $f:X\rightarrow \re$ and $g:X\rightarrow Y$ denote differentiable functions.  For example, these problems include linearly constrained quadratic programs such as
$$
        \min_{x\in\re^2}\{x_1^2+x_2^2 : (x_1-2)^2 + (x_2-2)^2 = 1 \}
$$
In order to minimize this formulation in PEOpt, we use the code in Figure \ref{fig:simpleEq} and the input specification in Figure \ref{fig:simpleEqJSON}, which generates the output in Figure \ref{fig:simpleEqOut}.  Similar to the previous two examples, we explain the functions used to generate this example in Chapter \ref{ch:Basic}, the input specification in Chapter \ref{ch:Input}, and the output in Chapter \ref{ch:Output}.

\input{simple_eq_code.tex}
\input{simple_eq_input.tex}
\input{simple_eq_output.tex}

\section{Constrained Optimization}\setcounter{figure}{3}

        The PEOpt constrained optimization routines solve problems in the form
$$
        \min_{x\in X} \{ f(x) : g(x)=0, h(x)\succeq 0 \}
$$
where $f:X\rightarrow \re$ and $g:X\rightarrow Y$ denote differentiable functions, $h:X\rightarrow Z$ denotes an affine function, and $\succeq$ denotes a partial order that corresponds to a symmetric cone.  For example, these formulations include constrained problems such as 
$$
        \min_{x\in\re^2}\{(x+1)^2+(y+1)^2 :  x + 2y = 1, 2x + y \geq 1 \} 
$$
In order to minimize this formulation in PEOpt, we use the code in Figure \ref{fig:simpleCon} and the input specification in Figure \ref{fig:simpleConJSON}, which generates the output in Figure \ref{fig:simpleConOut}.  As with the other examples in the introduction, we explain the functions used to generate this example in Chapter \ref{ch:Basic}, the input specification in Chapter \ref{ch:Input}, and the output in Chapter \ref{ch:Output}.

\input{simple_con_code.tex}
\input{simple_con_input.tex}
\input{simple_con_output.tex}

\chapter{Installation}\label{ch:Install}

    Depending on the requirements of the application, PEOpt has several different build an installation methods.  In the most simple case, PEOpt can be incorporated into a project as a header taken from the source directory.  In a more complete case, PEOpt uses CMake in order to manage the installation of several supporting libraries.  We discuss these methods below.

        Outside the installation mechanism, there are two primary modes in which we access the PEOpt routines: headers only and as a library.  In headers only mode, PEOpt enables access to the core optimization and verification routines, which include utilities such as finite-difference tests.  In libary mode, PEOpt also includes predefined vector spaces as well as parameter readers that read in parameter files in JSON format.

\section{Header Only Installation with No Build System}

        At its core, PEOpt requires two headers: \url{peopt.h} and \url{linalg.h} found in the \url{./src/cpp/peopt} directory.  Copy these files to a directory labeled \url{peopt} in the incorporating projects source tree.  Then, add the
\begin{verbatim}
    #include <peopt/peopt.h>
\end{verbatim}
directive to the source files where PEOpt is used.


\section{Header Only Installation with CMake}

        In order to do a header only installation with CMake, we require CMake version 2.4 or better.  In the base PEOpt directory, execute the following commands
\begin{verbatim}
    mkdir build
    cd build
    cmake -DCMAKE_INSTALL_PREFIX=/dir/to/install/location ../src
    make install
\end{verbatim}
This installs the appropriate PEOpt headers to the directory \url{/dir/to/install/location/include/peopt}.

\section{Library Installation with CMake}

        In order to fully install PEOpt using CMake, we require CMake version 2.8.9 or better.  Then, in the base PEOpt directory, execute the following commands
\begin{verbatim}
    mkdir build
    cd build
    ccmake ../src
    make
    make install
\end{verbatim}
The command \texttt{ccmake} executes the curses version of CMake, which displays several different options.  The PEOpt specific flags are
\begin{center}
\begin{longtable}{lp{0.75\textwidth}}
Flag:         &\texttt{ENABLE\_CPP\_LIBRARY}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{BLAS\_LIBRARY}, \texttt{LAPACK\_LIBRARY},
              \texttt{JSONCPP\_INCLUDE\_DIR}, \texttt{JSONCPP\_LIBRARY}\\
Autodetect?:  &No\\
Description:  &Enables the the library build for peopt.  This includes the
              built-in vector spaces for real vectors or cone programming.\\
\\
Flag:         &\texttt{ENABLE\_CPP\_EXAMPLES}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY}\\
Autodetect?:  &No\\
Description:  &Enables the build and installation of simple examples that
              demonstrate the use of peopt.  These examples are installed to
              the directory
              \url{${CMAKE_INSTALL_PREFIX}/share/peopt/cpp/examples}.\\
\\
Flag:         &\texttt{ENABLE\_CPP\_UNIT}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY},
              \texttt{BOOST\_UNIT\_TEST\_INCLUDE\_DIR},
              \texttt{BOOST\_UNIT\_TEST\_LIBRARY}\\
Autodetect?:  &No\\
Description:  &Enables the build and installation of unit tests that help
              validate the peopt code.  These tests are installed to the
              directory \url{${CMAKE_INSTALL_PREFIX}/share/peopt/cpp/unit}.\\
\\
Flag:         &\texttt{ENABLE\_OPENMP}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY}\\
Autodetect?:  &No\\
Description:  &Toggles whether or not the peopt library should be compiled
              using OpenMP.  This primarily affect whether or not the
              prepackaged vector spaces are coded to run in parallel using
              threads.\\
\\
Flag:         &\texttt{ENABLE\_PYTHON}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY}, \texttt{PYTHON\_INCLUDE\_DIR}, \texttt{PYTHON\_LIBRARY}\\
Autodetect?:  &No\\
Description:  &Enables the build and installation of the Python wrappers for
              peopt.  The resulting Python module is installed to
              \url{${CMAKE_INSTALL_PREFIX}/share/peopt/python}.  As such, make
              sure that the PYTHONPATH includes this directory.  In addition,
              using this module assumes that libpeopt\_complete.so can be found
              in the LD\_LIBRARY\_PATH.\\
\\
Flag:         &\texttt{ENABLE\_PYTHON\_EXAMPLES}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{ENABLE\_PYTHON\_LIBRARY}\\
Autodetect?:  &No\\
Description:  &Enables the build and installation of examples that use the
              Python wrappers for peopt.  These examples are installed into
              the directory
              \url{${CMAKE_INSTALL_PREFIX}/share/peopt/python/examples.}\\
\\
Flag:         &\texttt{ENABLE\_MATLAB}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY}, \texttt{MATLAB\_INCLUDE\_DIR},
              \texttt{MATLAB\_LIBRARY}, \texttt{MATLAB\_MEX\_EXTENSION}\\
Autodetect?:  &No\\
Description:  &Enables the build and installation of the MATLAB wrappers for
              peopt.  The resulting MATLAB mex file is installed to
              \url{${CMAKE_INSTALL_PREFIX}/share/peopt/matlab}.  As such, make
              sure that the MATLAB path includes this directory. \\
\\
Flag:         &\texttt{ENABLE\_MATLAB\_EXAMPLES}\\
Type:         &Bool\\
Default:      &Off\\
Dependencies: &\texttt{ENABLE\_MATLAB\_LIBRARY}\\
Autodetect?:  &No\\
Description:  &Enables the build and installation of examples that use the
              MATLAB wrappers for peopt.  These examples are installed into
              the directory
              \url{${CMAKE_INSTALL_PREFIX}/share/peopt/matlab/examples}.\\
\\
Flag:         &\texttt{BLAS\_LIBRARY} \\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY} \\
Autodetect?:  &Yes \\
Description:  &A semicolon separated list of the complete path and library used
              to provide BLAS.  This must include all required libraries in
              order to successfully compile a BLAS dependent application.  For
              example, using ATLAS BLAS, one possible entry is:
              \url{/usr/lib/libf77blas.a;/usr/lib/libatlas.a}\\
\\
Flag:         &\texttt{LAPACK\_LIBRARY} \\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY} \\
Autodetect?:  &Yes \\
Description:  &A semicolon separated list of the complete path and library used
              to provide LAPACK.  This must include all required libraries,
              except for BLAS libraries above in \texttt{BLAS\_LIBRARY}, in
              order to successfully compile a LAPACK dependent application.
              For example, using ATLAS LAPACK, one possible entry is:
              \url{/usr/lib/liblapack.a;/usr/lib/libcblas.a;/usr/lib/libgfortran.so.3}\\
\\
Flag:         &\texttt{BOOST\_UNIT\_TEST\_INCLUDE\_DIR} \\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_CPP\_UNIT} \\
Autodetect?:  &Yes \\
Description:  &A path that indicates where the boost headers for unit testing
              have been installed.  The actual header must be found at
              \url{${BOOST_UNIT_TEST_INCLUDE_DIR}/boost/test/unit_test.hpp}.\\
\\
Flag:         &\texttt{BOOST\_UNIT\_TEST\_LIBRARY}\\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_CPP\_UNIT}\\
Autodetect?:  &Yes \\
Description:  &The complete path and library for the boost unit test
              framework. \\
\\
Flag:         &\texttt{JSONCPP\_INCLUDE\_DIR} \\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY} \\
Autodetect?:  &Yes \\
Description:  &A path that indicates where the jsoncpp headers have been 
              installed.  The actual headers must be found in 
              \url{${BOOST_UNIT_TEST_INCLUDE_DIR}/json/}.\\
\\
Flag:         &\texttt{JSONCPP\_LIBRARY}\\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_CPP\_LIBRARY}\\
Autodetect?:  &Yes \\
Description:  &The complete path and library for jsoncpp. \\
\\
Flag:         &\texttt{PYTHON\_INCLUDE\_DIR} \\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_PYTHON} \\
Autodetect?:  &Yes \\
Description:  &A path that indicates where the Python 2.7 headers have been 
              installed.  We do not prefix these headers, so we look directly
              in the directory provided here.\\
\\
Flag:         &\texttt{PYTHON\_LIBRARY}\\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_PYTHON}\\
Autodetect?:  &Yes \\
Description:  &The complete path and library for Python 2.7. \\
\\
Flag:         &\texttt{MATLAB\_INCLUDE\_DIR} \\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_MATLAB}\\
Autodetect?:  &Yes \\
Description:  &A path that indicates where the MATLAB headers have been 
              installed.  We do not prefix these headers, so we look directly
              in the directory provided here.\\
\\
Flag:         &\texttt{MATLAB\_LIBRARY}\\
Type:         &Path \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_MATLAB}\\
Autodetect?:  &Yes \\
Description:  &The complete path and library for the mex library.  Typically,
              this is libmex.so on Linux.\\
\\
Flag:         &\texttt{MATLAB\_MEX\_EXTENSION}\\
Type:         &String \\
Default:      &None \\
Dependencies: &\texttt{ENABLE\_MATLAB}\\
Autodetect?:  &No \\
Description:  &The extension of mex files on the system.  This can be found
              by typing in the command 'mexext' inside of MATLAB.  Note, copy
              the output from 'mexext' directly and do not add a '.'.
\end{longtable}
\end{center}
       
\chapter{Basic API}\label{ch:Basic}
\chapter{Input Specifications}\label{ch:Input}
\chapter{Output}\label{ch:Output}
\chapter{Advanced API}\label{ch:Advanced}
\end{document}
